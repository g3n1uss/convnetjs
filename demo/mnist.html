<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>ConvNetJS MNIST demo</title>
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="stylesheet" href="css/style.css">

  <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">
  <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/grids-responsive-min.css">

<!-- Load additional libs -->
<script src="js/jquery-1.8.3.min.js"></script>
<script src="../build/vis.js"></script>
<script src="../build/util.js"></script>
<script src="../build/convnet.js"></script>
<script src="mnist/mnist_labels.js"></script>

<script type="text/javascript">
   var layer_defs, net, trainer;
  // we can consider the following simplified configuration (one layer of each type)
  // it makes the network to converge slower, but it is easier to debug

  // Can we remove the definition of the input layer, because it can be read off from the input data?
  // It cannot be done because the program randomly crops 28x28 images down to 24x24, 
  // this technique is called data augmentation

  // The number of filters is chosen empirically, other numbers of filters work pretty good too
  var t = "layer_defs = [];\n\
  layer_defs.push({type:'input', out_sx:24, out_sy:24, out_depth:1});\n\
  layer_defs.push({type:'conv', sx:5, filters:8, stride:1, pad:2, activation:'relu'});\n\
  layer_defs.push({type:'pool', sx:2, stride:2});\n\
  layer_defs.push({type:'softmax', num_classes:10});"
  /*\n\
  net = new convnetjs.Net();\n\
  net.makeLayers(layer_defs);\n\
  \n\
  trainer = new convnetjs.SGDTrainer(net, {method:'adadelta', batch_size:20, l2_decay:0.001});\n\
  ";*/
  // CAN WE REPLACE CONFIGURING THE NETWORK BY BUILDING THE CONFIGURATION AS LEGO?
  // ADD PARAMETERS OF TRAINER IN ADDITIONAL BOX
</script>
<script src="js/images-demo.js">
  // everything happens in this lib
</script>

</head>
<body>
  <div id="wrap">
  <h2 style="text-align: center;"><a href="http://cs.stanford.edu/people/karpathy/convnetjs/">ConvNetJS</a> MNIST demo</h2>
  <h1>Description</h1>
  <p>
    This demo trains a Convolutional Neural Network on the <a href="http://yann.lecun.com/exdb/mnist/">MNIST digits dataset</a> in your browser, with nothing but Javascript. The dataset is fairly easy and one should expect to get somewhere around 99% accuracy within few minutes. I used <a href="mnist_parse.zip">this python script</a> to parse the <a href="http://deeplearning.net/tutorial/gettingstarted.html">original files</a> into batches of images that can be easily loaded into page DOM with img tags.
  </p>
  <p>
    This network takes a 28x28 MNIST image and crops a random 24x24 window before training on it (this technique is called data augmentation and improves generalization). Similarly to do prediction, 4 random crops are sampled and the probabilities across all crops are averaged to produce final predictions. The network runs at about 5ms for both forward and backward pass on my reasonably decent Ubuntu+Chrome machine.
  </p>
  <p>
    By default, in this demo we're using Adadelta which is one of per-parameter adaptive step size methods, so we don't have to worry about changing learning rates or momentum over time. However, I still included the text fields for changing these if you'd like to play around with SGD+Momentum trainer.
  </p>
  <p>Report questions/bugs/suggestions to <a href="https://twitter.com/karpathy">@karpathy</a>.</p>

  <h1>Choose a Network Configuration</h1>
  <div>
    <textarea id="newnet" style="width:100%; height:200px;"></textarea><br />
    <input id="buttonnn" type="submit" value="change network" onclick="change_net();" style="width:200px;height:30px;"/>
  </div>

  <h1>Set up the Trainer</h1>
  <!--<div>
    <form action="#" onsubmit="return setTrainerParams(this);">
    Training method:<input type="text" id="train_method"><br>
    Learning rate:<input type="text" id="lr_input"><br>
    Momentum:<input type="text" id="momentum_input"><br>
    Batch size:<input type="text" id="batch_size_input"><br>
    Weight decay:<input type="text" id="decay_input"><br>
    <input type="submit" value="Change Trainer Parameters">
    </form>

  </div>-->

<!-- TODO: change trainer method to a drop-down list -->
  <form class="pure-form pure-form-stacked">
    <fieldset>
        <div class="pure-g">
            <div class="pure-u-1 pure-u-md-1-3">
                <label>Training method</label>
                <input id="train_method" class="pure-u-23-24" type="text">
            </div>

            <div class="pure-u-1 pure-u-md-1-3">
                <label>Learning rate</label>
                <input id="lr_input" class="pure-u-23-24" type="text">
            </div>

            <div class="pure-u-1 pure-u-md-1-3">
                <label>Momentum</label>
                <input id="momentum_input" class="pure-u-23-24" type="text">
            </div>

            <div class="pure-u-1 pure-u-md-1-3">
                <label>Batch size</label>
                <input id="batch_size_input" class="pure-u-23-24" type="text">
            </div>

            <div class="pure-u-1 pure-u-md-1-3">
                <label>Weight decay</label>
                <input id="decay_input" class="pure-u-23-24" type="text">
            </div>

            <div class="pure-u-1 pure-u-md-1-3">
                <label>Epsilon</label>
                <input id="epsilon_input" class="pure-u-23-24" type="text">
            </div>
        </div>

        <button type="submit" class="pure-button pure-button-active">Change Trainer</button>
    </fieldset>
</form>

<!--<form class="pure-form pure-form-aligned" action="#" onsubmit="return setTrainerParams(this);">
    <fieldset>
        <div class="pure-control-group">
            <label for="name">Training method</label>
            <input id="train_method" type="text" placeholder="Training method">
        </div>

        <div class="pure-control-group">
            <label for="name">Learning rate</label>
            <input id="lr_input" type="text" placeholder="Learning rate">
        </div>

        <div class="pure-control-group">
            <label for="name">Momentum</label>
            <input id="momentum_input" type="text" placeholder="Momentum">
        </div>

        <div class="pure-control-group">
            <label for="name">Batch size</label>
            <input id="batch_size_input" type="text" placeholder="Batch size">
        </div>

        <div class="pure-control-group">
            <label for="name">Weight decay</label>
            <input id="decay_input" type="text" placeholder="Weight decay">
        </div>

        <div class="pure-controls">
            <button type="submit" class="pure-button pure-button-primary">Change Trainer</button>
        </div>
    </fieldset>
</form>-->


  <h1>Training Stats</h1>
  <div class="divsec" style="270px;">
    <div class="secpart">
      <input id="buttontp" type="submit" value="pause" onclick="toggle_pause();" style="width: 100px; height:30px; background-color: #FCC;"/>
      <div id="trainstats"></div>

      <!--<div id="controls">
        Learning rate: <input name="lri" type="text" maxlength="20" id="lr_input"/>
        <input id="buttonlr" type="submit" value="change" onclick="change_lr();"/>
        <br />

        Momentum: <input name="momi" type="text" maxlength="20" id="momentum_input"/>
        <input id="buttonmom" type="submit" value="change" onclick="change_momentum();"/>
        <br />

        Batch size: <input name="bsi" type="text" maxlength="20" id="batch_size_input"/>
        <input id="buttonbs" type="submit" value="change" onclick="change_batch_size();"/>
        <br />

        Weight decay: <input name="wdi" type="text" maxlength="20" id="decay_input"/>
        <input id="buttonwd" type="submit" value="change" onclick="change_decay();"/>
      </div>-->

      <input id="buttondj" type="submit" value="save network snapshot as JSON" onclick="dump_json();"/><br />
      <input id="buttonlfj" type="submit" value="init network from JSON snapshot" onclick="load_from_json();"/><br />
      <textarea id="dumpjson"></textarea>
    </div>
    <div class="secpart">
      <div>
        Loss:<br />
        <canvas id="lossgraph">
        </canvas>
        <br />
        <input id="buttoncg" type="submit" value="clear graph" onclick="clear_graph();"/>
      </div>
    </div>
    <div class="secpart"> 
      <div id="upload_box">
        Test an image from your computer:
        <div id="img_div">
            <img id="preview_img"/>
        </div>
        <input name="image" type="file" accept="image/*" onchange="loadFile(event)">

        <input type="submit" value="Test Image" onclick="testImage(document.getElementById('preview_img'))">
      </div>
    </div>
    <div style="clear:both;"></div>
  </div>



  <div class="divsec">
  <h1>Network Visualization</h1>
    <div id="visnet"></div>
  </div>
  
  <div class="divsec">
  <h1>Example predictions on Test set</h1>
    <div id="testset_acc"></div>
	<div id="testset_vis"></div><!--this part is rewritten in the web version to bound appearing of new images. In its current version they keep popping up -->
  </div>

  </div>  
</body>
</html>



